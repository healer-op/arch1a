<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ArchiaAi Payment Callback</title>
<link rel="stylesheet" href="https://archiastudio.com/warehouse/css/fonts.css" />
<style>
body {
  background: #fafafa;
  font-family: Causten-ExtraBold, sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}
.loader {
  text-align: center;
}
.loader img {
  width: 80px;
  border-radius: 100%;
}
iframe {
  width: 100%;
  height: 100vh;
  border: none;
}
</style>
</head>
<body>
  <div id="content" class="loader">
    <img src="https://archiastudio.com/warehouse/data/images/loading.gif" alt="Loading..." />
    <h2>Checking Payment Status...</h2>
  </div>

  <script>
  async function loadCallback() {
    const params = new URLSearchParams(window.location.search);
    const apiKey = params.get("apiKey");
    const plan = params.get("plan");
    const orderId = params.get("orderId");

    if (!apiKey || !plan || !orderId) {
      document.getElementById("content").innerHTML = "<h3>❌ Invalid parameters.</h3>";
      return;
    }

    try {
      const url = `https://api.archiastudio.com/api/phonepe/callback?apiKey=${encodeURIComponent(apiKey)}&plan=${encodeURIComponent(plan)}&orderId=${encodeURIComponent(orderId)}`;
      console.log("[Relay] Fetching:", url);

      const res = await fetch(url, { headers: { "Content-Type": "text/html" } });
      const html = await res.text();

      document.body.innerHTML = html;
    } catch (err) {
      document.getElementById("content").innerHTML = `<h3>⚠️ Error: ${err}</h3>`;
    }
  }
  loadCallback();
  </script>
</body>
</html>
